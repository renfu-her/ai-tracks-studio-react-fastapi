<!-- Banner List Content Fragment (不含 html/head/body) -->
<div class="admin-card">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">Banner 管理</h2>
        <a href="#banners/add" class="btn btn-primary">
            <i class="fas fa-plus me-2"></i> 新增 Banner
        </a>
    </div>

    <!-- Table Container -->
    <div id="bannersTable">
        <div class="text-center py-5">
            <div class="spinner-border text-primary"></div>
        </div>
    </div>

    <!-- Info -->
    <div class="d-flex justify-content-between align-items-center mt-3">
        <small class="text-muted" id="pageInfo"></small>
    </div>
</div>

<script>
window.pageInit = async function() {
    await loadBanners();

    async function loadBanners() {
        showLoading('bannersTable');
        try {
            const data = await apiRequest('/api/admin/banners?limit=100');
            renderBanners(data.items || []);
        } catch (error) {
            showError('bannersTable', error.message);
        }
    }

    function renderBanners(banners) {
        if (banners.length === 0) {
            $('#bannersTable').html(`
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i> 暫無 Banner 資料
                </div>
            `);
            $('#pageInfo').text('顯示 0 / 共 0 筆');
            return;
        }

        const html = `
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th style="width: 100px;">ID</th>
                            <th>頁面類型</th>
                            <th>圖片預覽</th>
                            <th style="width: 150px;">建立時間</th>
                            <th style="width: 150px;">更新時間</th>
                            <th style="width: 120px;" class="text-end">操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${banners.map(banner => `
                            <tr>
                                <td><code>${banner.id}</code></td>
                                <td>
                                    <span class="badge bg-primary">${getPageTypeLabel(banner.page_type)}</span>
                                </td>
                                <td>
                                    ${banner.image ? `
                                        <img src="${getImageUrl(banner.image)}" 
                                             class="img-thumbnail" 
                                             style="max-width: 100px; max-height: 60px; object-fit: cover;"
                                             alt="${banner.page_type}">
                                    ` : '<span class="text-muted">無圖片</span>'}
                                </td>
                                <td><small class="text-muted">${formatDateTime(banner.created_at)}</small></td>
                                <td><small class="text-muted">${formatDateTime(banner.updated_at)}</small></td>
                                <td class="text-end">
                                    <a href="#banners/edit/${banner.id}" class="btn btn-sm btn-outline-primary me-1" title="編輯">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <button class="btn btn-sm btn-outline-danger" 
                                            onclick="deleteBanner('${banner.id}')" 
                                            title="刪除">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        `;
        
        $('#bannersTable').html(html);
        $('#pageInfo').text(`顯示 ${banners.length} / 共 ${banners.length} 筆`);
    }

    function getPageTypeLabel(pageType) {
        const labels = {
            'HOME': '首頁',
            'GAME': 'Game',
            'WEBSITE': 'Website',
            'NEWS': 'News',
            'ABOUT': 'About'
        };
        return labels[pageType] || pageType;
    }

    async function deleteBanner(id) {
        if (!confirm('確定要刪除這個 Banner 嗎？')) return;
        
        try {
            await apiRequest(`/api/admin/banners/${id}`, { method: 'DELETE' });
            showSuccessToast('刪除成功！');
            await loadBanners();
        } catch (error) {
            showErrorToast('刪除失敗: ' + error.message);
        }
    }

    window.deleteBanner = deleteBanner;
};
</script>

