<!-- About List Content Fragment (不含 html/head/body) -->
<div class="admin-card">
    <!-- RWD Filter Bar - Flexbox 分散佈局 -->
    <div class="d-flex flex-wrap gap-3 mb-4 align-items-center justify-content-between">
        <!-- 搜尋框 -->
        <input type="text" class="form-control" id="searchInput" placeholder="搜尋標題..." style="min-width: 200px; max-width: 300px; flex: 1 1 auto;">
        
        <!-- 新增按鈕 -->
        <a href="#about/add" class="btn btn-primary" style="white-space: nowrap;">
            <i class="fas fa-plus me-2"></i> 新增 About
        </a>
    </div>

    <!-- Table Container -->
    <div id="aboutTable">
        <div class="text-center py-5">
            <div class="spinner-border text-primary"></div>
        </div>
    </div>

    <!-- Pagination Info -->
    <div class="d-flex justify-content-between align-items-center mt-3">
        <small class="text-muted" id="pageInfo"></small>
    </div>
</div>

<script>
window.pageInit = async function() {
    let allAbout = [];

    await loadAbout();

    $('#searchInput').on('input', filterAbout);

    async function loadAbout() {
        showLoading('aboutTable');
        try {
            const items = await apiRequest('/api/admin/about');
            allAbout = Array.isArray(items) ? items : [items];
            filterAbout();
        } catch (error) {
            showError('aboutTable', error.message);
        }
    }

    function filterAbout() {
        const search = $('#searchInput').val().toLowerCase();
        const filtered = allAbout.filter(a => 
            (a.title || '').toLowerCase().includes(search) ||
            (a.subtitle || '').toLowerCase().includes(search)
        );
        renderAbout(filtered);
    }

    function renderAbout(aboutList) {
        if (aboutList.length === 0) {
            $('#aboutTable').html(`
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i> 暫無資料
                </div>
            `);
            $('#pageInfo').text('顯示 0 / 共 0 筆');
            return;
        }

        const html = `
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th style="width: 60px;">ID</th>
                            <th>標題</th>
                            <th>副標題</th>
                            <th style="width: 150px;">Email</th>
                            <th style="width: 140px;">更新時間</th>
                            <th style="width: 160px;" class="text-center">操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${aboutList.map(a => `
                            <tr>
                                <td><span class="badge bg-secondary">${a.id}</span></td>
                                <td class="fw-bold">${a.title || '-'}</td>
                                <td class="small text-muted">${a.subtitle || '-'}</td>
                                <td class="small">${a.contact_email || '-'}</td>
                                <td class="small">${formatDateTime(a.updated_at)}</td>
                                <td class="text-center">
                                    <a href="#about/edit/${a.id}" class="btn btn-sm btn-outline-primary me-1">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <button onclick="deleteAbout(${a.id})" class="btn btn-sm btn-outline-danger">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        `;

        $('#aboutTable').html(html);
        $('#pageInfo').text(`顯示 1-${aboutList.length} / 共 ${aboutList.length} 筆`);
    }

    window.deleteAbout = async function(id) {
        confirmDelete(
            `確定要刪除 About (ID: <strong>${id}</strong>) 嗎？<br><span class="text-danger">此操作無法復原。</span>`,
            async function() {
                try {
                    await apiRequest(`/api/admin/about/${id}`, { method: 'DELETE' });
                    showSuccessToast('刪除成功！');
                    await loadAbout();
                } catch (error) {
                    showErrorToast('刪除失敗: ' + error.message);
                }
            }
        );
    };
};
</script>

